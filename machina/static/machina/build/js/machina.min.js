var machina=function(t,e){function n(t,n){var i=e(t).clone(!0),o=e("#id_"+n+"-TOTAL_FORMS").val();i.find(":input").each(function(){var t=e(this).attr("name").replace("-"+(o-1)+"-","-"+o+"-");e(this).attr("name",t);var n=e(this).attr("id").replace("-"+(o-1)+"-","-"+o+"-");e(this).attr("id",n),e(this).parent("label").attr("for",n),e(this).prev("label").attr("for",n),e(this).is(":checkbox")?e(this).attr("checked",!1):(e(this).attr("value",""),e(this).val(""))}),i.find(".initial").remove(),e("#id_"+n+"-TOTAL_FORMS").val(parseInt(o)+1),e(t).after(i)}function i(t){var n=e(t).parents(".post-review .post-content");return 0!=n.length&&n[0]}return t.poll={init:function(t,i){"undefined"==typeof t&&(t="#add_more_poll_option"),"undefined"==typeof i&&(i="#poll_formset div.poll-option-form:last"),e(t).click(function(t){t.preventDefault(),n(i,"poll")})}},t.attachment={init:function(t,i){"undefined"==typeof t&&(t="#add_more_attachment"),"undefined"==typeof i&&(i="#attachment_formset div.attachment-form:last"),e(t).click(function(t){t.preventDefault(),n(i,"attachment")})}},t.quote={init:function(n,o,a){void 0!==document.getSelection&&("undefined"==typeof n&&(n=".quote-menu"),"undefined"==typeof o&&(o="#quote-button"),"undefined"==typeof a&&(a="#quote-hint"),e(o).hide(),e(n).removeClass("hidden"),e(document).on("selectstart selectionchange",function(t){var n=document.getSelection();""!=n&&i(n.anchorNode)&&i(n.focusNode)?(e(a).hide(),e(o).show()):(e(o).hide(),e(a).show())}),e(o).click(function(e){t.quote.insert_quote(document.getSelection())}))},insert_quote:function(t){var n=MachinaMarkdownEditor.editors.id_content;if(MachinaMarkdownEditor){var o="\n > *",a=e(i(t.anchorNode)).parent().find("p small.text-muted").text().trim();o+="**"+a+"**",o+=": "+t.toString()+"*\n\n";var r=n.value();n.value(r+o)}else Console.error("You have to implement `machina.quote.insert_quote(Selection)` when using a custom editor!")}},t.init=function(){},t}(machina||{},jQuery);